SOURCES_START = common/crtbegin.cc
SOURCES_END = common/crtend.cc

SOURCES += $(ARCH)/cpu.cc $(ARCH)/bind.cc $(ARCH)/intlogic.cc \
	   common/elfsimple.cc common/hiostream.cc common/aftertime.cc \
	   common/gcc_support.cc common/memory.cc common/string.cc \
	   l4ka/startup.cc l4ka/l4privileged.cc l4ka/debug.cc \
	   l4ka/l4thread.cc l4ka/vcpu.cc l4ka/main.cc l4ka/resourcemon.cc \
	   l4ka/module_manager.cc l4ka/linux-2.6.cc l4ka/backend.cc \
	   l4ka/monitor.cc l4ka/exports.cc


SOURCES_vmvmextcommon = $(ARCH)/burn.S $(ARCH)/rewrite_stackless.cc \
	   common/memory.cc common/elfrewrite.cc common/burn_symbols.cc \
	   l4ka/common/backend.cc l4ka/common/user.cc

SOURCES_vmhvmcommon = l4ka/common/irq.cc 

ifeq "$(CONFIG_L4KA_VM)" "y"
SOURCES += $(SOURCES_vmvmextcommon) $(SOURCES_vmhvmcommon) l4ka/vm/backend.cc l4ka/vm/vcpu.cc l4ka/vm/task.cc
endif

ifeq "$(CONFIG_L4KA_VMEXT)" "y"
SOURCES += $(SOURCES_vmvmextcommon) l4ka/vmext/backend.cc l4ka/vmext/vcpu.cc l4ka/vmext/task.cc  
endif

ifeq "$(CONFIG_L4KA_HVM)" "y"
SOURCES += $(SOURCES_vmhvmcommon) l4ka/hvm/backend.cc l4ka/hvm/task.cc l4ka/hvm/vcpu.cc l4ka/hvm/vm8086.cc

afterburn-wedge: $(BUILDDIR)/rombios.elf $(BUILDDIR)/vgabios.elf 

$(BUILDDIR)/%.elf: $(SRCDIR)/../contrib/vbios/%.elf
	@cp -v $< $@

clean::
	@$(RM) $(BUILDDIR)/rombios.elf $(BUILDDIR)/vgabios.elf 

endif

#SOURCES += device/kbd.cc

SOURCES-$(CONFIG_DEVICE_DP83820) += l4ka/dp83820.cc
SOURCES-$(CONFIG_DEVICE_PCI_FORWARD) += l4ka/pci_forward.cc

IDL_SOURCES += resourcemon_idl.idl L4VMblock_idl.idl
IDL_SOURCES-$(CONFIG_DEVICE_DP83820) += L4VMnet_idl.idl lanaddress_idl.idl
IDL_SOURCES-$(CONFIG_DEVICE_PCI_FORWARD) += L4VMpci_idl.idl


